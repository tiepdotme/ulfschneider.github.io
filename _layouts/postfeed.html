<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0">
    <channel>
        <title>{{- site.title -}}</title>        
        <description></description>
        <link>{{- site.url -}}{{- site.baseurl -}}</link>
        <pubDate>{{ site.time | date_to_rfc822 }}</pubDate>
        <lastBuildDate>{{- site.time | date_to_rfc822 -}}</lastBuildDate>
        <generator>Jekyll v{{- jekyll.version -}}</generator>

        {%- assign imageUrl = "src=&quot;" -%}
        {%- assign imageUrl = imageUrl | append: site.url -%}
        {%- assign imageUrl = imageUrl | append: site.baseurl -%}
        {%- assign imageUrl = imageUrl | append: "/" -%}

        {%- assign postUrl = "href=&quot;" -%}
        {%- assign postUrl = postUrl | append: site.url -%}
        {%- assign postUrl = postUrl | append: site.baseurl -%}
        {%- assign postUrl = postUrl | append: "/" -%}

        {%- assign pageMeta = "" | split: "" -%}
        {%- assign pageMeta = pageMeta | push: page.tags -%}
        {%- assign pageMeta = pageMeta | push: page.categories -%}
        {%- assign pageMeta = pageMeta | compact | uniq -%}
        {%- if pageMeta.size == 0 -%}
        {%- assign pageMeta = pageMeta | push: "." -%}
        {%- endif -%}

        {%- for p in site.posts -%}
        {%- if p.published != false and p.exclude_feed != true -%}
        {%- unless page.exclude_layouts contains p.layout -%}
        {%- for meta in pageMeta -%}
        {%- if meta == "." or p.tags contains meta or p.categories contains meta -%}
        <item>
            <title>{{ p.title | xml_escape }}</title>
            <author>{{ p.author }}</author>
            <description>
                {%- if p.subtitle -%}&lt;p&gt;{{- p.subtitle -}}&lt;/p&gt;{%- endif -%}
                {%- if p.refer -%}&lt;p&gt;{{- p.refer -}}&lt;/p&gt;{%- endif -%}
                {{- p.content | xml_escape | replace: "src=&quot;/",imageUrl | replace: "href=&quot;/",postUrl -}}
            </description>
            <pubDate>{{- p.date | date_to_rfc822 -}}</pubDate>
            <link>{{- p.url | prepend: site.baseurl | prepend: site.url -}}</link>
            <guid>{{- p.url | prepend: site.baseurl | prepend: site.url -}}</guid>
            {%- for tag in p.tags -%}
            <category>{{- tag | xml_escape -}}</category>
            {%- endfor -%}
            {%- for c in p.categories -%}
            <category>{{- c | xml_escape -}}</category>
            {%- endfor -%}
        </item>
        {%- break -%}
        {%- endif -%}
        {%- endfor -%}
        {%- endunless -%}
        {%- endif -%}        
        {%- endfor -%}
    </channel>
</rss>